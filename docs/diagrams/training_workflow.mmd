graph LR
    subgraph "Client Side"
        Client[Client Application]
        Config[Configuration]
    end

    subgraph "Azure Services"
        VM[Confidential VM]
        Attest[Attestation Service]
        KV[Key Vault]
        Storage[Secure Storage]
    end

    subgraph "Secure Environment"
        Enclave[Secure Enclave]
        Data[Encrypted Data]
        Model[ML Model]
    end

    subgraph "Monitoring"
        Monitor[Security Monitor]
        Alert[Alert System]
    end

    Client -->|1\. Initialize| VM
    Config -->|2\. Load Config| VM
    VM -->|3\. Request Attestation| Attest
    Attest -->|4\. Verify Environment| VM
    VM -->|5\. Request Keys| KV
    KV -->|6\. Provide Keys| VM
    VM -->|7\. Request Data| Storage
    Storage -->|8\. Provide Data| Data
    VM -->|\. Load Data & Keys| Enclave
    Enclave -->|10\. Decrypt Data| Data
    Enclave -->|\. Train Model| Model
    Model -->|12\. Save Checkpoint| Storage
    Monitor -->|13\. Monitor Progress| Enclave
    Model -->|14\. Save Final Model| Storage
    Storage -->|15\. Training Complete| Client

    Note over Client,Storage: Secure Training Workflow
    Note over Enclave: All sensitive operations<br/>performed in secure enclave
    Note over Monitor: Continuous security monitoring 